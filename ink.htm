<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>安全跳转中...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="color-scheme" content="light dark">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/iosxlb/static@main/favicon/link.ico" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/tailwindcss">
    body {
      @apply bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 font-sans;
    }
    .container {
      @apply max-w-md mx-auto p-4;
    }
    .btn-primary {
      @apply bg-primary text-white py-2 px-4 rounded-lg shadow hover:shadow-lg transition-all duration-300;
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen">
  <div class="container">
    <div class="text-center">
      <h1 class="text-2xl font-bold mb-4">安全跳转中...</h1>
      <p class="text-gray-500 mb-6">请稍候，正在为您跳转到目标页面。</p>
      <div id="loading" class="mb-6">
        <i class="fa fa-spinner fa-spin text-primary text-4xl"></i>
      </div>
      <div id="error" class="hidden text-red-500 text-sm mb-4">
        <!-- 错误信息将在这里显示 -->
      </div>
      <button id="retryBtn" class="btn-primary hidden" onclick="retryJump()">
        <i class="fa fa-refresh mr-2"></i> 重试
      </button>
    </div>
  </div>
  <script>
    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
      // 获取参数
      var params = new URLSearchParams(window.location.search);
      var encodedParams = params.get('c');
      var suffix = params.get('s');
      
      // 验证参数
      if (!encodedParams) {
        showError('参数错误，请检查链接是否正确！');
        return;
      }
      
      // 解码参数
      try {
        var decodedParams = JSON.parse(atob(encodedParams));
        var url = decodedParams.url;
        var expire = decodedParams.expire;
        var expectedSuffix = decodedParams.suffix;
        
        // 验证链接有效期
        if (expire > 0) {
          var timestamp = Date.now() / 1000;
          var createTime = timestamp - expire;
          if (timestamp > createTime) {
            showError('链接已过期！');
            return;
          }
        }
        
        // 验证自定义后缀（如果存在）
        if (expectedSuffix && expectedSuffix !== suffix) {
          showError('链接无效！');
          return;
        }
        
        // 验证目标网址
        if (!/^https?:\/\//i.test(url)) {
          showError('目标网址无效！');
          return;
        }
        
        // 跳转到目标网址
        window.location.href = url;
      } catch (err) {
        showError('参数解码失败，请检查链接是否正确！');
      }
    });
    
    // 显示错误信息
    function showError(message) {
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('error').textContent = message;
      document.getElementById('error').classList.remove('hidden');
      document.getElementById('retryBtn').classList.remove('hidden');
    }
    
    // 重试跳转
    function retryJump() {
      window.location.reload();
    }
  </script>
</body>
</html>
